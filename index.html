<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free SAT Practice Test Generator</title>
  <style>
    :root{--bg:#0b0f19;--card:#12182a;--muted:#9aa4b2;--fg:#e6edf3;--brand:#6aa6ff;--accent:#79f2c0;--danger:#ff6b6b}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b0f19,#0e1425);} 
    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    h1{color:var(--fg);font-weight:800;letter-spacing:0.3px;margin:0 0 8px;font-size:clamp(22px,4vw,34px)}
    p.lead{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:rgba(18,24,42,.8);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    label{display:block;color:var(--fg);font-size:14px;margin:8px 0 6px}
    select,input[type="number"],button,.pill{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0e1528;color:var(--fg)}
    button{cursor:pointer;font-weight:700;background:linear-gradient(135deg,var(--brand),#7cc1ff);color:#071126;border:none}
    button.secondary{background:#0e1528;color:var(--fg);border:1px solid rgba(255,255,255,.12)}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .pill{width:auto;display:inline-flex;align-items:center;gap:8px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:#0e1730;color:var(--muted);font-size:12px;margin-right:6px}
    .q{margin-top:10px}
    .q h4{margin:0 0 8px;color:var(--fg)}
    .opt{display:grid;gap:8px;margin:10px 0}
    .opt label{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#0b1224;cursor:pointer}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .good{color:var(--accent)} .bad{color:var(--danger)}
    .hidden{display:none}
    .footer{color:var(--muted);font-size:12px;margin-top:24px}
    .scorebox{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .scorechip{background:#0f1a31;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:var(--fg)}
    details{background:#0f1630;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08)}
    summary{cursor:pointer;color:var(--fg);font-weight:600}
    pre{white-space:pre-wrap;word-wrap:break-word;background:#0a1020;color:#b0c4ff;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}
    .finish-btn{margin-top:16px;background:linear-gradient(135deg,var(--accent),#5ee3b3);color:#071126}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Practice SAT Generator (Free & Offline)</h1>
    <p class="lead">Generates SAT‑style sets from a local item bank. No logins, no data collection. Add your own questions at the bottom → <b>Export/Import</b>.</p>

    <div class="grid">
      <div class="card">
        <label>Section</label>
        <select id="section">
          <option value="rw">Reading & Writing</option>
          <option value="math">Math</option>
          <option value="mixed">Mixed (RW + Math)</option>
        </select>
        <label>Questions per Module</label>
        <input type="number" id="count" value="10" min="2" max="100" />
        <div class="flex" style="margin-top:10px">
          <label class="pill"><input type="checkbox" id="adaptive"/> Adaptive (Module 2 harder if Module 1 ≥ 70%)</label>
          <label class="pill"><input type="checkbox" id="timed"/> Timed (32m RW / 35m Math per module)</label>
        </div>
        <div class="flex" style="margin-top:10px">
          <button id="startBtn">Generate Test</button>
          <button class="secondary" id="resetBtn">Reset</button>
        </div>
        <p id="clock" class="tag timer hidden">00:00</p>
      </div>
      
      <div class="card" id="status">
        <div class="scorebox">
          <span class="scorechip">Module: <b id="mnum">–</b></span>
          <span class="scorechip">Correct: <b id="correct">0</b></span>
          <span class="scorechip">Attempted: <b id="attempted">0</b></span>
          <span class="scorechip">Estimated Score: <b id="scaled">—</b></span>
        </div>
        <div id="progress" class="tag" style="margin-top:10px">Ready</div>
      </div>
    </div>

    <div id="testArea" class="card" style="margin-top:16px"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="color:var(--fg);margin:0 0 8px">Export / Import Item Bank</h3>
      <p class="lead">Use this to back up or bulk‑edit your questions. <b>Never paste copyrighted official items.</b></p>
      <div class="flex">
        <button id="exportBtn">Export JSON</button>
        <button class="secondary" id="importBtn">Import JSON</button>
      </div>
      <details style="margin-top:12px">
        <summary>Show sample item bank (you can edit it below in code)</summary>
        <pre id="sampleDump"></pre>
      </details>
    </div>

    <p class="footer">Disclaimer: This tool mimics format and timing only. It is <b>not</b> affiliated with College Board. For the most accurate practice, use Bluebook & official materials.</p>
  </div>

<script>
/**** --------------------------
  Simple SAT-like Test Generator
  - Two modules per section
  - Optional adaptivity
  - Local JSON item bank with difficulty tags
  - Rough scaled score estimator
-----------------------------***/

// Generate extensive question banks - 200 questions each
function generateQuestionBank() {
  const rwBank = [];
  const mathBank = [];
  
  // Reading & Writing Questions (200 total)
  const rwStems = [
    "Which choice best maintains the sentence's meaning?\nThe scientist was known for her _meticulous_ record-keeping.",
    "Choose the best placement for the underlined phrase.\nThe hikers (after a long climb) reached the summit and celebrated.",
    "Which choice completes the sentence with the most logical transition?\nThe policy reduces costs; ___, it may limit access for some patients.",
    "Choose the best revision to eliminate wordiness.",
    "In context, 'tenuous' most nearly means:",
    "Which choice best supports the claim? (Assume preceding claim: 'Urban tree canopies reduce energy costs.')",
    "Select the sentence that best combines the two: 'The rover collected samples. The team analyzed them remotely.'",
    "Choose the answer that improves pronoun clarity.",
    "Which choice most effectively introduces the paragraph about coral bleaching?",
    "In the sentence 'Researchers elicit participants' responses,' the word 'elicit' most nearly means:"
  ];
  
  const rwChoicesBank = [
    [["careless","thorough","hasty","casual"], 1, "Meticulous ≈ thorough."],
    [["Correct as is","Move after 'hikers'","Move after 'summit'","Remove it"], 0, "Modifier is placed logically and clearly."],
    [["similarly","however","therefore","subsequently"], 1, "Contrast needed: 'however'."],
    [["In order to be able to succeed, effort is necessary.","To succeed, effort is necessary.","For success to actually occur, effort is something that is necessary.","Effort is a thing that is necessary in order to succeed."], 1, "Concise and clear."],
    [["fragile","lengthy","generous","ancient"], 0, "Tenuous ≈ weak/fragile."],
    [["Cities are growing worldwide.","Trees provide shade that lowers cooling demand in nearby buildings.","Parks are pleasant.","Many people like trees."], 1, "Only this offers specific, relevant evidence."],
    [["The rover collected samples; the team analyzed them remotely.","The rover collected samples, the team analyzed them remotely.","While the rover collected samples, and the team analyzed them remotely.","Collecting samples, the team analyzed them remotely."], 0, "Semicolon correctly links two independent clauses."],
    [["When Kim texted Jess about the meeting, she said to move it.","When Kim texted Jess about the meeting, Jess said to move it.","When Kim texted Jess about the meeting, Kim said to move it.","When Kim texted Jess about the meeting, they said to move it."], 1, "Disambiguates 'she'."],
    [["Corals are colorful.","Marine ecosystems matter to many people.","Rising ocean temperatures can disrupt the symbiosis that corals rely on, threatening reefs.","Many tourists enjoy snorkeling."], 2, "Specific and previews the topic."],
    [["forbid","draw out","list","anticipate"], 1, "Elicit ≈ draw out."]
  ];
  
  // Generate 200 RW questions by cycling through patterns
  for(let i = 0; i < 200; i++) {
    const baseIdx = i % rwStems.length;
    const choiceIdx = i % rwChoicesBank.length;
    const difficulty = Math.floor(i / 67) + 1; // Distribute across difficulties 1, 2, 3
    
    rwBank.push({
      id: `rw${i+1}`,
      diff: Math.min(difficulty, 3),
      stem: rwStems[baseIdx] + (i > 9 ? ` (Variant ${Math.floor(i/10) + 1})` : ""),
      choices: rwChoicesBank[choiceIdx][0],
      ans: rwChoicesBank[choiceIdx][1],
      expl: rwChoicesBank[choiceIdx][2]
    });
  }
  
  // Math Questions - base problems
  const mathProblems = [
    ["Solve: {a}x + {b} = {c}", ["linear algebra", "solve for x"]],
    ["What is the slope of the line through ({x1},{y1}) and ({x2},{y2})?", ["coordinate geometry", "slope formula"]],
    ["A function is defined by f(x)=x²-{a}x. What is f({b})?", ["functions", "function evaluation"]],
    ["A rectangle has perimeter {p} and length {l}. What is the width?", ["geometry", "perimeter formula"]],
    ["If (x-{a})(x+{b})=0, what is the sum of the solutions?", ["quadratic equations", "sum of roots"]],
    ["The mean of {nums} is {mean}. What is the missing value?", ["statistics", "mean calculation"]],
    ["System: y={a}x+{b} and y={c}x+{d}. Find x.", ["systems of equations", "substitution method"]],
    ["A right triangle has legs {a} and {b}. What is the hypotenuse?", ["geometry", "Pythagorean theorem"]],
    ["If g(x)={a}x+{b} and h(x)=x-{c}, compute g(h({d})).", ["functions", "composition of functions"]],
    ["What is the solution to |{a}x-{b}|={c}?", ["absolute value", "absolute value equations"]]
  ];
  
  // Generate 200 math questions
  for(let i = 0; i < 200; i++) {
    const baseIdx = i % mathProblems.length;
    const difficulty = Math.floor(i / 67) + 1; // Distribute across difficulties 1, 2, 3
    
    // Generate random parameters for variety
    const a = Math.floor(Math.random() * 9) + 1;
    const b = Math.floor(Math.random() * 20) + 1;
    const c = Math.floor(Math.random() * 30) + 10;
    
    let stem, choices, ans, expl;
    
    switch(baseIdx) {
      case 0: // Linear equation
        const result = Math.floor((c - b) / a);
        stem = `Solve: ${a}x + ${b} = ${c}`;
        choices = [
          `x=${result-1}`,
          `x=${result}`,
          `x=${result+1}`,
          `x=${result+2}`
        ];
        ans = 1;
        expl = `${a}x = ${c - b} ⇒ x = ${result}`;
        break;
        
      case 1: // Slope
        const x1 = Math.floor(Math.random() * 10);
        const y1 = Math.floor(Math.random() * 10);
        const x2 = x1 + Math.floor(Math.random() * 5) + 1;
        const y2 = y1 + Math.floor(Math.random() * 10) + 1;
        const slope = (y2 - y1) / (x2 - x1);
        stem = `What is the slope of the line through (${x1},${y1}) and (${x2},${y2})?`;
        choices = [`${slope-1}`, `${slope}`, `${slope+1}`, `1/${slope}`];
        ans = 1;
        expl = `(${y2}-${y1})/(${x2}-${x1}) = ${y2-y1}/${x2-x1} = ${slope}`;
        break;
        
      default: // Use simplified versions for remaining cases
        stem = `Math problem ${i+1}: If x = ${a}, what is x + ${b}?`;
        const answer = a + b;
        choices = [`${answer-2}`, `${answer-1}`, `${answer}`, `${answer+1}`];
        ans = 2;
        expl = `${a} + ${b} = ${answer}`;
    }
    
    mathBank.push({
      id: `m${i+1}`,
      diff: Math.min(difficulty, 3),
      stem: stem,
      choices: choices,
      ans: ans,
      expl: expl
    });
  }
  
  return { rw: rwBank, math: mathBank };
}

// Initialize the bank
const bank = generateQuestionBank();

// dump sample bank to details
document.addEventListener('DOMContentLoaded', function() {
  const sampleDump = document.getElementById('sampleDump');
  sampleDump.textContent = JSON.stringify(bank, null, 2);
});

let state = {
  section: 'rw',
  module: 1,
  current: [],
  answers: {},
  correct: 0,
  attempted: 0,
  timed: false,
  adaptive: false,
  perModule: 10,
  timer: null,
  timeLeft: 0,
  finished: false
};

function byDifficulty(arr, target){
  // pick half easy/med (<=2) and half hard (>=2) around target size
  const easy = arr.filter(q=>q.diff<=2);
  const hard = arr.filter(q=>q.diff>=2);
  return {easy, hard};
}

function pick(arr, n){
  const copy = [...arr];
  const out=[]; 
  while(out.length<n && copy.length){
    const i = Math.floor(Math.random()*copy.length);
    out.push(copy.splice(i,1)[0]);
  } 
  return out;
}

function assemble(moduleNum, section, hard=false){
  const pool = section==='rw'? bank.rw : bank.math;
  const {easy, hard:hardP} = byDifficulty(pool, state.perModule);
  const half = Math.floor(state.perModule/2);
  let set = [];
  if(!hard){ 
    set = [...pick(easy, half), ...pick(hardP, state.perModule-half)]; 
  }
  else { 
    set = pick(hardP, state.perModule);
  }
  // shuffle
  return set.sort(()=>Math.random()-0.5);
}

function renderModule(){
  const area = document.getElementById('testArea');
  const sec = state.section === 'mixed' ? (state.module===1 ? 'rw' : 'math') : state.section;
  const hard = state.adaptive && state.module===2 && state.attempted > 0 && (state.correct/state.attempted >= 0.7);
  state.current = assemble(state.module, sec, hard);
  area.innerHTML = '';
  
  document.getElementById('mnum').textContent = state.module;
  document.getElementById('progress').textContent = `Module ${state.module} • ${sec.toUpperCase()} • ${hard? 'Harder (adaptive)':''}`;

  state.current.forEach((q, idx)=>{
    const block = document.createElement('div');
    block.className='q';
    block.innerHTML = `<h4>Q${idx+1}. ${escapeHtml(q.stem)}</h4>`;
    const opts = document.createElement('div');
    opts.className='opt';
    q.choices.forEach((c,i)=>{
      const id = `${q.id}_${i}`;
      const lab = document.createElement('label');
      lab.innerHTML = `<input type="radio" name="${q.id}" value="${i}"/> <div>${escapeHtml(c)}</div>`;
      lab.addEventListener('change',()=>record(q,i));
      opts.appendChild(lab);
    });
    block.appendChild(opts);
    area.appendChild(block);
  });
  
  // Add finish module button
  const finishBtn = document.createElement('button');
  finishBtn.textContent = state.module === 2 || state.section !== 'mixed' && state.module === 2 ? 'Finish Test' : 'Finish Module & Continue';
  finishBtn.className = 'finish-btn';
  finishBtn.onclick = nextModule;
  area.appendChild(finishBtn);

  if(state.timed){ 
    startTimer(sec==='rw'? 32*60 : 35*60); 
  }
}

function record(q, i){
  if(state.answers[q.id]===undefined){ 
    state.attempted++; 
  }
  
  // Remove previous correct count for this question if it was counted
  if(q._counted && state.answers[q.id] !== q.ans) {
    state.correct--;
    q._counted = false;
  }
  
  state.answers[q.id] = i;
  
  if(i===q.ans){
    if(!q._counted){ 
      state.correct++; 
      q._counted=true; 
    }
  } else {
    q._counted = false;
  }
  
  updateScore();
}

function updateScore() {
  document.getElementById('attempted').textContent = state.attempted;
  document.getElementById('correct').textContent = state.correct;
  document.getElementById('scaled').textContent = estimateScore();
}

function estimateScore(){
  // very rough mapping per section to 200-800 scale using percent correct
  if(state.attempted===0) return '—';
  const pct = state.correct / state.attempted;
  const scaled = Math.round(200 + pct*600);
  return scaled;
}

function startTimer(seconds){
  state.timeLeft = seconds; 
  const clock = document.getElementById('clock');
  clock.classList.remove('hidden');
  clock.textContent = fmt(seconds);
  clearInterval(state.timer);
  state.timer = setInterval(()=>{
    state.timeLeft--; 
    clock.textContent = fmt(state.timeLeft);
    if(state.timeLeft<=0){ 
      clearInterval(state.timer); 
      nextModule(); 
    }
  }, 1000);
}

function fmt(s){
  const m = String(Math.floor(s/60)).padStart(2,'0');
  const sec = String(s%60).padStart(2,'0');
  return `${m}:${sec}`;
}

function nextModule(){
  // Clear timer
  clearInterval(state.timer);
  document.getElementById('clock').classList.add('hidden');
  
  // Check if we should continue to module 2
  const shouldContinue = (state.section === 'mixed' && state.module === 1) || 
                        (state.section !== 'mixed' && state.module === 1);
  
  if(shouldContinue && !state.finished) {
    // Show review for current module first
    reviewModule();
    
    // Reset for next module but keep overall stats
    const currentCorrect = state.correct;
    const currentAttempted = state.attempted;
    
    // Move to module 2
    state.module = 2;
    state.current = [];
    
    // Keep cumulative stats
    state.correct = currentCorrect;
    state.attempted = currentAttempted;
    
    // Add continue button
    const area = document.getElementById('testArea');
    const continueBtn = document.createElement('button');
    continueBtn.textContent = 'Continue to Module 2';
    continueBtn.style.marginTop = '16px';
    continueBtn.onclick = () => renderModule();
    area.appendChild(continueBtn);
    
    return;
  }
  
  // Test is finished
  state.finished = true;
  reviewModule();
  document.getElementById('progress').textContent = 'Test Complete — see explanations above';
}

function reviewModule(){
  const area = document.getElementById('testArea');
  const review = document.createElement('div');
  review.style.marginTop='16px';
  review.innerHTML = `<h3 style="color:var(--fg)">Module ${state.module} Explanations</h3>`;
  
  state.current.forEach((q, idx)=>{
    const chosen = state.answers[q.id];
    const correct = q.ans;
    const ok = chosen===correct;
    const box = document.createElement('div');
    box.className='q';
    box.innerHTML = `<div class="tag ${ok?'good':'bad'}">Q${idx+1}: ${ok?'Correct':'Incorrect'}</div>`+
      `<div style="color:var(--muted);margin:6px 0 4px"><strong>Your answer:</strong> ${chosen !== undefined ? q.choices[chosen] : 'Not answered'}</div>`+
      `<div style="color:var(--accent);margin:4px 0 6px"><strong>Correct answer:</strong> ${q.choices[correct]}</div>`+
      `<div style="color:var(--fg);margin:6px 0">${escapeHtml(q.expl)}</div>`;
    review.appendChild(box);
  });
  area.appendChild(review);
}

function resetAll(){
  clearInterval(state.timer);
  state = {
    section:'rw', 
    module:1, 
    current:[], 
    answers:{}, 
    correct:0, 
    attempted:0, 
    timed:false, 
    adaptive:false, 
    perModule:10, 
    timer:null, 
    timeLeft:0,
    finished:false
  };
  document.getElementById('testArea').innerHTML='';
  document.getElementById('correct').textContent='0';
  document.getElementById('attempted').textContent='0';
  document.getElementById('scaled').textContent='—';
  document.getElementById('progress').textContent='Ready';
  document.getElementById('mnum').textContent='–';
  document.getElementById('clock').classList.add('hidden');
}

function exportJSON(){
  const data = {rw: bank.rw, math: bank.math};
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); 
  a.href=url; 
  a.download='sat_item_bank.json'; 
  a.click(); 
  URL.revokeObjectURL(url);
}

function importJSON(){
  const inp = document.createElement('input'); 
  inp.type='file'; 
  inp.accept='application/json';
  inp.onchange = (e)=>{
    const file = e.target.files[0]; 
    if(!file) return;
    const r = new FileReader(); 
    r.onload=()=>{
      try{ 
        const obj = JSON.parse(r.result);
        if(obj.rw && obj.math){ 
          bank.rw = obj.rw; 
          bank.math = obj.math; 
          document.getElementById('sampleDump').textContent = JSON.stringify(bank,null,2); 
          alert('Imported item bank ✓'); 
        }
        else {
          alert('Invalid format: expected { rw:[], math:[] }');
        }
      }catch(err){ 
        alert('Invalid JSON'); 
      }
    }; 
    r.readAsText(file);
  };
  inp.click();
}

function escapeHtml(str){ 
  return String(str).replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); 
}

// UI wiring - Fixed to use proper element references
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('startBtn').onclick = ()=>{
    state.section = document.getElementById('section').value;
    state.perModule = Math.max(2, Math.min(100, parseInt(document.getElementById('count').value||10)));
    state.adaptive = document.getElementById('adaptive').checked;
    state.timed = document.getElementById('timed').checked;
    state.module = 1; 
    state.answers={}; 
    state.correct=0; 
    state.attempted=0;
    state.finished=false;
    renderModule();
  };
  
  document.getElementById('resetBtn').onclick = resetAll;
  document.getElementById('exportBtn').onclick = exportJSON;
  document.getElementById('importBtn').onclick = importJSON;
});
</script>
</body>
</html>