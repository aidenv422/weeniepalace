<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free SAT Practice Test Generator</title>
  <style>
    :root{--bg:#0b0f19;--card:#12182a;--muted:#9aa4b2;--fg:#e6edf3;--brand:#6aa6ff;--accent:#79f2c0;--danger:#ff6b6b}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b0f19,#0e1425);} 
    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    h1{color:var(--fg);font-weight:800;letter-spacing:0.3px;margin:0 0 8px;font-size:clamp(22px,4vw,34px)}
    p.lead{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:rgba(18,24,42,.8);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    label{display:block;color:var(--fg);font-size:14px;margin:8px 0 6px}
    select,input[type="number"],button,.pill{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0e1528;color:var(--fg)}
    button{cursor:pointer;font-weight:700;background:linear-gradient(135deg,var(--brand),#7cc1ff);color:#071126;border:none}
    button.secondary{background:#0e1528;color:var(--fg);border:1px solid rgba(255,255,255,.12)}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .pill{width:auto;display:inline-flex;align-items:center;gap:8px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:#0e1730;color:var(--muted);font-size:12px;margin-right:6px}
    .q{margin-top:10px}
    .q h4{margin:0 0 8px;color:var(--fg)}
    .opt{display:grid;gap:8px;margin:10px 0}
    .opt label{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#0b1224;cursor:pointer}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .good{color:var(--accent)} .bad{color:var(--danger)}
    .hidden{display:none}
    .footer{color:var(--muted);font-size:12px;margin-top:24px}
    .scorebox{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .scorechip{background:#0f1a31;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:var(--fg)}
    details{background:#0f1630;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08)}
    summary{cursor:pointer;color:var(--fg);font-weight:600}
    pre{white-space:pre-wrap;word-wrap:break-word;background:#0a1020;color:#b0c4ff;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}
    .finish-btn{margin-top:16px;background:linear-gradient(135deg,var(--accent),#5ee3b3);color:#071126}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Practice SAT Generator (Free & Offline)</h1>
    <p class="lead">Generates SAT‑style sets from a local item bank. No logins, no data collection. Add your own questions at the bottom → <b>Export/Import</b>.</p>

    <div class="grid">
      <div class="card">
        <label>Section</label>
        <select id="section">
          <option value="rw">Reading & Writing</option>
          <option value="math">Math</option>
          <option value="mixed">Mixed (RW + Math)</option>
        </select>
        <label>Questions per Module</label>
        <input type="number" id="count" value="50" min="2" max="50" />
        <div class="flex" style="margin-top:10px">
          <label class="pill"><input type="checkbox" id="adaptive"/> Adaptive (Module 2 harder if Module 1 ≥ 70%)</label>
          <label class="pill"><input type="checkbox" id="timed"/> Timed (32m RW / 35m Math per module)</label>
        </div>
        <div class="flex" style="margin-top:10px">
          <button id="startBtn">Generate Test</button>
          <button class="secondary" id="resetBtn">Reset</button>
        </div>
        <p id="clock" class="tag timer hidden">00:00</p>
      </div>
      
      <div class="card" id="status">
        <div class="scorebox">
          <span class="scorechip">Module: <b id="mnum">–</b></span>
          <span class="scorechip">Correct: <b id="correct">0</b></span>
          <span class="scorechip">Attempted: <b id="attempted">0</b></span>
          <span class="scorechip">Estimated Score: <b id="scaled">—</b></span>
        </div>
        <div id="progress" class="tag" style="margin-top:10px">Ready</div>
      </div>
    </div>

    <div id="testArea" class="card" style="margin-top:16px"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="color:var(--fg);margin:0 0 8px">Export / Import Item Bank</h3>
      <p class="lead">Use this to back up or bulk‑edit your questions. <b>Never paste copyrighted official items.</b></p>
      <div class="flex">
        <button id="exportBtn">Export JSON</button>
        <button class="secondary" id="importBtn">Import JSON</button>
      </div>
      <details style="margin-top:12px">
        <summary>Show sample item bank (you can edit it below in code)</summary>
        <pre id="sampleDump"></pre>
      </details>
    </div>

    <p class="footer">Disclaimer: This tool mimics format and timing only. It is <b>not</b> affiliated with College Board. For the most accurate practice, use Bluebook & official materials.</p>
  </div>

<script>
/**** --------------------------
  Simple SAT-like Test Generator
  - Two modules per section
  - Optional adaptivity
  - Local JSON item bank with difficulty tags
  - Rough scaled score estimator
-----------------------------***/

// Generate extensive question banks - 1000 questions each
function generateQuestionBank() {
  const rwBank = [];
  const mathBank = [];
  
  // Reading & Writing Question Templates (expanded)
  const rwTemplates = [
    // Grammar & Usage
    {stem: "Which choice best maintains the sentence's meaning?\nThe {adjective} {noun} was known for being _{word}_.", 
     type: "vocabulary", difficulty: 1},
    {stem: "Choose the best placement for the underlined phrase.\nThe {subjects} ({modifier}) {verb} and {action}.", 
     type: "modifier", difficulty: 1},
    {stem: "Which choice completes the sentence with the most logical transition?\n{statement1}; ___, {statement2}.", 
     type: "transition", difficulty: 2},
    {stem: "Choose the best revision to eliminate wordiness.", 
     type: "concision", difficulty: 2},
    {stem: "In context, '{word}' most nearly means:", 
     type: "vocab_context", difficulty: 2},
    {stem: "Which choice best supports the claim? (Assume preceding claim: '{claim}')", 
     type: "evidence", difficulty: 3},
    {stem: "Select the sentence that best combines the two: '{sentence1}' '{sentence2}'", 
     type: "combining", difficulty: 2},
    {stem: "Choose the answer that improves pronoun clarity.", 
     type: "pronouns", difficulty: 1},
    {stem: "Which choice most effectively introduces the paragraph about {topic}?", 
     type: "introduction", difficulty: 2},
    {stem: "The author uses {literary_device} in order to:", 
     type: "rhetoric", difficulty: 3},
    // Reading Comprehension
    {stem: "According to the passage, {topic} is characterized by:", 
     type: "comprehension", difficulty: 1},
    {stem: "The primary purpose of the passage is to:", 
     type: "main_idea", difficulty: 2},
    {stem: "The author's attitude toward {subject} can best be described as:", 
     type: "tone", difficulty: 2},
    {stem: "Which statement best describes the relationship between {concept1} and {concept2}?", 
     type: "relationships", difficulty: 3},
    {stem: "The data in the graph supports which conclusion?", 
     type: "data_analysis", difficulty: 3}
  ];
  
  // Word banks for variety
  const wordBanks = {
    adjectives: ["meticulous", "diligent", "ambitious", "innovative", "persistent", "analytical", "creative", "methodical", "strategic", "resourceful"],
    nouns: ["scientist", "researcher", "engineer", "architect", "professor", "analyst", "designer", "manager", "consultant", "specialist"],
    transitions: ["however", "therefore", "furthermore", "nevertheless", "consequently", "moreover", "similarly", "conversely", "subsequently", "likewise"],
    topics: ["climate change", "renewable energy", "artificial intelligence", "genetic engineering", "space exploration", "ocean conservation", "urban planning", "sustainable agriculture", "medical research", "archaeological discoveries"],
    literary_devices: ["metaphor", "symbolism", "irony", "alliteration", "personification", "imagery", "foreshadowing", "juxtaposition", "allegory", "hyperbole"]
  };
  
  // Generate 1000 RW questions
  for(let i = 0; i < 1000; i++) {
    const template = rwTemplates[i % rwTemplates.length];
    const difficulty = Math.floor(Math.random() * 3) + 1;
    
    // Fill template with random words for variety
    let stem = template.stem;
    const replacements = {
      '{adjective}': wordBanks.adjectives[Math.floor(Math.random() * wordBanks.adjectives.length)],
      '{noun}': wordBanks.nouns[Math.floor(Math.random() * wordBanks.nouns.length)],
      '{word}': wordBanks.adjectives[Math.floor(Math.random() * wordBanks.adjectives.length)],
      '{topic}': wordBanks.topics[Math.floor(Math.random() * wordBanks.topics.length)],
      '{literary_device}': wordBanks.literary_devices[Math.floor(Math.random() * wordBanks.literary_devices.length)]
    };
    
    Object.keys(replacements).forEach(key => {
      stem = stem.replace(key, replacements[key]);
    });
    
    // Generate appropriate choices based on question type
    let choices, ans, expl;
    switch(template.type) {
      case "vocabulary":
        choices = ["careless", "thorough", "hasty", "casual"];
        ans = 1;
        expl = "Context suggests precision and care.";
        break;
      case "transition":
        choices = ["similarly", "however", "therefore", "subsequently"];
        ans = Math.floor(Math.random() * 4);
        expl = "Consider the logical relationship between the statements.";
        break;
      case "evidence":
        choices = [
          "General background information",
          "Specific supporting data or example", 
          "Unrelated interesting fact",
          "Personal opinion"
        ];
        ans = 1;
        expl = "Evidence should directly support the claim.";
        break;
      default:
        choices = ["Option A", "Option B", "Option C", "Option D"];
        ans = Math.floor(Math.random() * 4);
        expl = "Consider context and standard usage.";
    }
    
    rwBank.push({
      id: `rw${i+1}`,
      diff: difficulty,
      stem: stem + ` (Question ${i+1})`,
      choices: choices,
      ans: ans,
      expl: expl
    });
  }
  
  // Math Question Templates (expanded)
  const mathTemplates = [
    // Algebra
    {type: "linear", stem: "Solve: {a}x + {b} = {c}", difficulty: 1},
    {type: "quadratic", stem: "Solve: x² + {b}x + {c} = 0", difficulty: 2},
    {type: "system", stem: "System: y = {a}x + {b} and y = {c}x + {d}. Find x.", difficulty: 2},
    {type: "inequality", stem: "Solve: {a}x + {b} > {c}", difficulty: 2},
    {type: "exponential", stem: "If {a}^x = {b}, what is x?", difficulty: 3},
    // Geometry
    {type: "slope", stem: "What is the slope of the line through ({x1},{y1}) and ({x2},{y2})?", difficulty: 1},
    {type: "area", stem: "A rectangle has length {l} and width {w}. What is its area?", difficulty: 1},
    {type: "perimeter", stem: "A rectangle has perimeter {p} and length {l}. What is the width?", difficulty: 1},
    {type: "pythagorean", stem: "A right triangle has legs {a} and {b}. What is the hypotenuse?", difficulty: 2},
    {type: "circle", stem: "A circle has radius {r}. What is its area?", difficulty: 2},
    {type: "volume", stem: "A cylinder has radius {r} and height {h}. What is its volume?", difficulty: 3},
    // Functions
    {type: "function_eval", stem: "If f(x) = x² - {a}x + {b}, what is f({c})?", difficulty: 2},
    {type: "composition", stem: "If g(x) = {a}x + {b} and h(x) = x - {c}, compute g(h({d})).", difficulty: 3},
    {type: "domain", stem: "What is the domain of f(x) = 1/(x - {a})?", difficulty: 2},
    {type: "inverse", stem: "If f(x) = {a}x + {b}, what is f⁻¹(x)?", difficulty: 3},
    // Statistics & Probability
    {type: "mean", stem: "The mean of {nums} is {mean}. What is the missing value?", difficulty: 1},
    {type: "median", stem: "What is the median of: {sequence}?", difficulty: 1},
    {type: "probability", stem: "A bag contains {r} red balls and {b} blue balls. What is P(red)?", difficulty: 2},
    {type: "combinations", stem: "How many ways can you choose {k} items from {n} items?", difficulty: 3},
    // Trigonometry
    {type: "basic_trig", stem: "In a right triangle, if sin θ = {fraction}, what is cos θ?", difficulty: 2},
    {type: "trig_identity", stem: "Simplify: sin²θ + cos²θ", difficulty: 2}
  ];
  
  // Generate 1000 math questions
  for(let i = 0; i < 1000; i++) {
    const template = mathTemplates[i % mathTemplates.length];
    const difficulty = Math.floor(Math.random() * 3) + 1;
    
    // Generate random parameters
    const params = {
      a: Math.floor(Math.random() * 9) + 1,
      b: Math.floor(Math.random() * 20) + 1,
      c: Math.floor(Math.random() * 30) + 10,
      d: Math.floor(Math.random() * 10) + 1,
      r: Math.floor(Math.random() * 5) + 1,
      h: Math.floor(Math.random() * 10) + 1,
      l: Math.floor(Math.random() * 15) + 5,
      w: Math.floor(Math.random() * 10) + 3,
      p: Math.floor(Math.random() * 40) + 20,
      x1: Math.floor(Math.random() * 10),
      y1: Math.floor(Math.random() * 10),
      x2: Math.floor(Math.random() * 10) + 5,
      y2: Math.floor(Math.random() * 10) + 5
    };
    
    // Fill in the template
    let stem = template.stem;
    Object.keys(params).forEach(key => {
      stem = stem.replace(`{${key}}`, params[key]);
    });
    
    let choices, ans, expl;
    
    // Generate appropriate answers based on question type
    switch(template.type) {
      case "linear":
        const result = Math.floor((params.c - params.b) / params.a);
        choices = [`x=${result-1}`, `x=${result}`, `x=${result+1}`, `x=${result+2}`];
        ans = 1;
        expl = `${params.a}x = ${params.c - params.b} ⇒ x = ${result}`;
        break;
        
      case "slope":
        const slope = Math.round(((params.y2 - params.y1) / (params.x2 - params.x1)) * 100) / 100;
        choices = [`${slope - 1}`, `${slope}`, `${slope + 1}`, `${Math.round((1/slope) * 100) / 100}`];
        ans = 1;
        expl = `slope = (${params.y2}-${params.y1})/(${params.x2}-${params.x1}) = ${slope}`;
        break;
        
      case "area":
        const area = params.l * params.w;
        choices = [`${area - 5}`, `${area}`, `${area + 5}`, `${area * 2}`];
        ans = 1;
        expl = `Area = length × width = ${params.l} × ${params.w} = ${area}`;
        break;
        
      case "mean":
        const nums = [6, 8, 10, "x"];
        const knownSum = 6 + 8 + 10;
        const target = params.a + 5; // mean
        const missing = target * 4 - knownSum;
        choices = [`${missing - 2}`, `${missing}`, `${missing + 2}`, `${missing + 4}`];
        ans = 1;
        expl = `Sum = ${target} × 4 = ${target * 4}. Missing value = ${target * 4} - ${knownSum} = ${missing}`;
        break;
        
      default:
        // Generic answer generation
        const answer = params.a + params.b;
        choices = [`${answer - 2}`, `${answer}`, `${answer + 1}`, `${answer + 3}`];
        ans = 1;
        expl = `Calculate step by step using given values.`;
    }
    
    mathBank.push({
      id: `m${i+1}`,
      diff: difficulty,
      stem: stem + ` (Problem ${i+1})`,
      choices: choices,
      ans: ans,
      expl: expl
    });
  }
  
  return { rw: rwBank, math: mathBank };
}

// Initialize the bank
const bank = generateQuestionBank();

// dump sample bank to details
document.addEventListener('DOMContentLoaded', function() {
  const sampleDump = document.getElementById('sampleDump');
  sampleDump.textContent = JSON.stringify(bank, null, 2);
});

let state = {
  section: 'rw',
  module: 1,
  current: [],
  answers: {},
  correct: 0,
  attempted: 0,
  timed: false,
  adaptive: false,
  perModule: 50,
  timer: null,
  timeLeft: 0,
  finished: false
};

function byDifficulty(arr, target){
  // pick half easy/med (<=2) and half hard (>=2) around target size
  const easy = arr.filter(q=>q.diff<=2);
  const hard = arr.filter(q=>q.diff>=2);
  return {easy, hard};
}

function pick(arr, n){
  const copy = [...arr];
  const out=[]; 
  while(out.length<n && copy.length){
    const i = Math.floor(Math.random()*copy.length);
    out.push(copy.splice(i,1)[0]);
  } 
  return out;
}

function assemble(moduleNum, section, hard=false){
  const pool = section==='rw'? bank.rw : bank.math;
  const {easy, hard:hardP} = byDifficulty(pool, state.perModule);
  const half = Math.floor(state.perModule/2);
  let set = [];
  if(!hard){ 
    set = [...pick(easy, half), ...pick(hardP, state.perModule-half)]; 
  }
  else { 
    set = pick(hardP, state.perModule);
  }
  // shuffle
  return set.sort(()=>Math.random()-0.5);
}

function renderModule(){
  const area = document.getElementById('testArea');
  const sec = state.section === 'mixed' ? (state.module===1 ? 'rw' : 'math') : state.section;
  const hard = state.adaptive && state.module===2 && state.attempted > 0 && (state.correct/state.attempted >= 0.7);
  state.current = assemble(state.module, sec, hard);
  area.innerHTML = '';
  
  document.getElementById('mnum').textContent = state.module;
  document.getElementById('progress').textContent = `Module ${state.module} • ${sec.toUpperCase()} • ${hard? 'Harder (adaptive)':''}`;

  state.current.forEach((q, idx)=>{
    const block = document.createElement('div');
    block.className='q';
    block.innerHTML = `<h4>Q${idx+1}. ${escapeHtml(q.stem)}</h4>`;
    const opts = document.createElement('div');
    opts.className='opt';
    q.choices.forEach((c,i)=>{
      const id = `${q.id}_${i}`;
      const lab = document.createElement('label');
      lab.innerHTML = `<input type="radio" name="${q.id}" value="${i}"/> <div>${escapeHtml(c)}</div>`;
      lab.addEventListener('change',()=>record(q,i));
      opts.appendChild(lab);
    });
    block.appendChild(opts);
    area.appendChild(block);
  });
  
  // Add finish module button
  const finishBtn = document.createElement('button');
  finishBtn.textContent = state.module === 2 || state.section !== 'mixed' && state.module === 2 ? 'Finish Test' : 'Finish Module & Continue';
  finishBtn.className = 'finish-btn';
  finishBtn.onclick = nextModule;
  area.appendChild(finishBtn);

  if(state.timed){ 
    startTimer(sec==='rw'? 32*60 : 35*60); 
  }
}

function record(q, i){
  if(state.answers[q.id]===undefined){ 
    state.attempted++; 
  }
  
  // Remove previous correct count for this question if it was counted
  if(q._counted && state.answers[q.id] !== q.ans) {
    state.correct--;
    q._counted = false;
  }
  
  state.answers[q.id] = i;
  
  if(i===q.ans){
    if(!q._counted){ 
      state.correct++; 
      q._counted=true; 
    }
  } else {
    q._counted = false;
  }
  
  updateScore();
}

function updateScore() {
  document.getElementById('attempted').textContent = state.attempted;
  document.getElementById('correct').textContent = state.correct;
  document.getElementById('scaled').textContent = estimateScore();
}

function estimateScore(){
  // very rough mapping per section to 200-800 scale using percent correct
  if(state.attempted===0) return '—';
  const pct = state.correct / state.attempted;
  const scaled = Math.round(200 + pct*600);
  return scaled;
}

function startTimer(seconds){
  state.timeLeft = seconds; 
  const clock = document.getElementById('clock');
  clock.classList.remove('hidden');
  clock.textContent = fmt(seconds);
  clearInterval(state.timer);
  state.timer = setInterval(()=>{
    state.timeLeft--; 
    clock.textContent = fmt(state.timeLeft);
    if(state.timeLeft<=0){ 
      clearInterval(state.timer); 
      nextModule(); 
    }
  }, 1000);
}

function fmt(s){
  const m = String(Math.floor(s/60)).padStart(2,'0');
  const sec = String(s%60).padStart(2,'0');
  return `${m}:${sec}`;
}

function nextModule(){
  // Clear timer
  clearInterval(state.timer);
  document.getElementById('clock').classList.add('hidden');
  
  // Check if we should continue to module 2
  const shouldContinue = (state.section === 'mixed' && state.module === 1) || 
                        (state.section !== 'mixed' && state.module === 1);
  
  if(shouldContinue && !state.finished) {
    // Show review for current module first
    reviewModule();
    
    // Reset for next module but keep overall stats
    const currentCorrect = state.correct;
    const currentAttempted = state.attempted;
    
    // Move to module 2
    state.module = 2;
    state.current = [];
    
    // Keep cumulative stats
    state.correct = currentCorrect;
    state.attempted = currentAttempted;
    
    // Add continue button
    const area = document.getElementById('testArea');
    const continueBtn = document.createElement('button');
    continueBtn.textContent = 'Continue to Module 2';
    continueBtn.style.marginTop = '16px';
    continueBtn.onclick = () => renderModule();
    area.appendChild(continueBtn);
    
    return;
  }
  
  // Test is finished
  state.finished = true;
  reviewModule();
  document.getElementById('progress').textContent = 'Test Complete — see explanations above';
}

function reviewModule(){
  const area = document.getElementById('testArea');
  const review = document.createElement('div');
  review.style.marginTop='16px';
  review.innerHTML = `<h3 style="color:var(--fg)">Module ${state.module} Explanations</h3>`;
  
  state.current.forEach((q, idx)=>{
    const chosen = state.answers[q.id];
    const correct = q.ans;
    const ok = chosen===correct;
    const box = document.createElement('div');
    box.className='q';
    box.innerHTML = `<div class="tag ${ok?'good':'bad'}">Q${idx+1}: ${ok?'Correct':'Incorrect'}</div>`+
      `<div style="color:var(--muted);margin:6px 0 4px"><strong>Your answer:</strong> ${chosen !== undefined ? q.choices[chosen] : 'Not answered'}</div>`+
      `<div style="color:var(--accent);margin:4px 0 6px"><strong>Correct answer:</strong> ${q.choices[correct]}</div>`+
      `<div style="color:var(--fg);margin:6px 0">${escapeHtml(q.expl)}</div>`;
    review.appendChild(box);
  });
  area.appendChild(review);
}

function resetAll(){
  clearInterval(state.timer);
  state = {
    section:'rw', 
    module:1, 
    current:[], 
    answers:{}, 
    correct:0, 
    attempted:0, 
    timed:false, 
    adaptive:false, 
    perModule:10, 
    timer:null, 
    timeLeft:0,
    finished:false
  };
  document.getElementById('testArea').innerHTML='';
  document.getElementById('correct').textContent='0';
  document.getElementById('attempted').textContent='0';
  document.getElementById('scaled').textContent='—';
  document.getElementById('progress').textContent='Ready';
  document.getElementById('mnum').textContent='–';
  document.getElementById('clock').classList.add('hidden');
}

function exportJSON(){
  const data = {rw: bank.rw, math: bank.math};
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); 
  a.href=url; 
  a.download='sat_item_bank.json'; 
  a.click(); 
  URL.revokeObjectURL(url);
}

function importJSON(){
  const inp = document.createElement('input'); 
  inp.type='file'; 
  inp.accept='application/json';
  inp.onchange = (e)=>{
    const file = e.target.files[0]; 
    if(!file) return;
    const r = new FileReader(); 
    r.onload=()=>{
      try{ 
        const obj = JSON.parse(r.result);
        if(obj.rw && obj.math){ 
          bank.rw = obj.rw; 
          bank.math = obj.math; 
          document.getElementById('sampleDump').textContent = JSON.stringify(bank,null,2); 
          alert('Imported item bank ✓'); 
        }
        else {
          alert('Invalid format: expected { rw:[], math:[] }');
        }
      }catch(err){ 
        alert('Invalid JSON'); 
      }
    }; 
    r.readAsText(file);
  };
  inp.click();
}

function escapeHtml(str){ 
  return String(str).replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); 
}

// UI wiring - Fixed to use proper element references
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('startBtn').onclick = ()=>{
    state.section = document.getElementById('section').value;
    state.perModule = Math.max(2, Math.min(50, parseInt(document.getElementById('count').value||50)));
    state.adaptive = document.getElementById('adaptive').checked;
    state.timed = document.getElementById('timed').checked;
    state.module = 1; 
    state.answers={}; 
    state.correct=0; 
    state.attempted=0;
    state.finished=false;
    renderModule();
  };
  
  document.getElementById('resetBtn').onclick = resetAll;
  document.getElementById('exportBtn').onclick = exportJSON;
  document.getElementById('importBtn').onclick = importJSON;
});
</script>
</body>
</html>