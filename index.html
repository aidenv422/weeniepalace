<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free SAT Practice Test Generator</title>
  <style>
    :root{--bg:#0b0f19;--card:#12182a;--muted:#9aa4b2;--fg:#e6edf3;--brand:#6aa6ff;--accent:#79f2c0;--danger:#ff6b6b}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b0f19,#0e1425);} 
    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    h1{color:var(--fg);font-weight:800;letter-spacing:0.3px;margin:0 0 8px;font-size:clamp(22px,4vw,34px)}
    p.lead{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:rgba(18,24,42,.8);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    label{display:block;color:var(--fg);font-size:14px;margin:8px 0 6px}
    select,input[type="number"],button,.pill{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0e1528;color:var(--fg)}
    button{cursor:pointer;font-weight:700;background:linear-gradient(135deg,var(--brand),#7cc1ff);color:#071126;border:none}
    button.secondary{background:#0e1528;color:var(--fg);border:1px solid rgba(255,255,255,.12)}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .pill{width:auto;display:inline-flex;align-items:center;gap:8px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:#0e1730;color:var(--muted);font-size:12px;margin-right:6px}
    .q{margin-top:10px}
    .q h4{margin:0 0 8px;color:var(--fg)}
    .opt{display:grid;gap:8px;margin:10px 0}
    .opt label{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#0b1224;cursor:pointer}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .good{color:var(--accent)} .bad{color:var(--danger)}
    .hidden{display:none}
    .footer{color:var(--muted);font-size:12px;margin-top:24px}
    .scorebox{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .scorechip{background:#0f1a31;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:var(--fg)}
    details{background:#0f1630;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08)}
    summary{cursor:pointer;color:var(--fg);font-weight:600}
    pre{white-space:pre-wrap;word-wrap:break-word;background:#0a1020;color:#b0c4ff;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}
    .finish-btn{margin-top:16px;background:linear-gradient(135deg,var(--accent),#5ee3b3);color:#071126}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Practice SAT Generator (Free & Offline)</h1>
    <p class="lead">Generates SAT‑style sets from a local item bank. No logins, no data collection. Add your own questions at the bottom → <b>Export/Import</b>.</p>

    <div class="grid">
      <div class="card">
        <label>Section</label>
        <select id="section">
          <option value="rw">Reading & Writing</option>
          <option value="math">Math</option>
          <option value="mixed">Mixed (RW + Math)</option>
        </select>
        <label>Questions per Module</label>
        <input type="number" id="count" value="10" min="2" max="40" />
        <div class="flex" style="margin-top:10px">
          <label class="pill"><input type="checkbox" id="adaptive"/> Adaptive (Module 2 harder if Module 1 ≥ 70%)</label>
          <label class="pill"><input type="checkbox" id="timed"/> Timed (32m RW / 35m Math per module)</label>
        </div>
        <div class="flex" style="margin-top:10px">
          <button id="startBtn">Generate Test</button>
          <button class="secondary" id="resetBtn">Reset</button>
        </div>
        <p id="clock" class="tag timer hidden">00:00</p>
      </div>
      
      <div class="card" id="status">
        <div class="scorebox">
          <span class="scorechip">Module: <b id="mnum">–</b></span>
          <span class="scorechip">Correct: <b id="correct">0</b></span>
          <span class="scorechip">Attempted: <b id="attempted">0</b></span>
          <span class="scorechip">Estimated Score: <b id="scaled">—</b></span>
        </div>
        <div id="progress" class="tag" style="margin-top:10px">Ready</div>
      </div>
    </div>

    <div id="testArea" class="card" style="margin-top:16px"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="color:var(--fg);margin:0 0 8px">Export / Import Item Bank</h3>
      <p class="lead">Use this to back up or bulk‑edit your questions. <b>Never paste copyrighted official items.</b></p>
      <div class="flex">
        <button id="exportBtn">Export JSON</button>
        <button class="secondary" id="importBtn">Import JSON</button>
      </div>
      <details style="margin-top:12px">
        <summary>Show sample item bank (you can edit it below in code)</summary>
        <pre id="sampleDump"></pre>
      </details>
    </div>

    <p class="footer">Disclaimer: This tool mimics format and timing only. It is <b>not</b> affiliated with College Board. For the most accurate practice, use Bluebook & official materials.</p>
  </div>

<script>
/**** --------------------------
  Simple SAT-like Test Generator
  - Two modules per section
  - Optional adaptivity
  - Local JSON item bank with difficulty tags
  - Rough scaled score estimator
-----------------------------***/

const bank = {
  rw: [
    {id:"rw1", diff:1, stem:"Which choice best maintains the sentence's meaning?\nThe scientist was known for her _meticulous_ record-keeping.", choices:["careless","thorough","hasty","casual"], ans:1, expl:"Meticulous ≈ thorough."},
    {id:"rw2", diff:1, stem:"Choose the best placement for the underlined phrase.\nThe hikers (after a long climb) reached the summit and celebrated.", choices:["Correct as is","Move after 'hikers'","Move after 'summit'","Remove it"], ans:0, expl:"Modifier is placed logically and clearly."},
    {id:"rw3", diff:2, stem:"Which choice completes the sentence with the most logical transition?\nThe policy reduces costs; ___, it may limit access for some patients.", choices:["similarly","however","therefore","subsequently"], ans:1, expl:"Contrast needed: 'however'."},
    {id:"rw4", diff:2, stem:"Choose the best revision to eliminate wordiness.", choices:["In order to be able to succeed, effort is necessary.","To succeed, effort is necessary.","For success to actually occur, effort is something that is necessary.","Effort is a thing that is necessary in order to succeed."], ans:1, expl:"Concise and clear."},
    {id:"rw5", diff:3, stem:"In context, 'tenuous' most nearly means:", choices:["fragile","lengthy","generous","ancient"], ans:0, expl:"Tenuous ≈ weak/fragile."},
    {id:"rw6", diff:3, stem:"Which choice best supports the claim? (Assume preceding claim: 'Urban tree canopies reduce energy costs.')", choices:["Cities are growing worldwide.","Trees provide shade that lowers cooling demand in nearby buildings.","Parks are pleasant.","Many people like trees."], ans:1, expl:"Only this offers specific, relevant evidence."},
    {id:"rw7", diff:2, stem:"Select the sentence that best combines the two: 'The rover collected samples. The team analyzed them remotely.'", choices:["The rover collected samples; the team analyzed them remotely.","The rover collected samples, the team analyzed them remotely.","While the rover collected samples, and the team analyzed them remotely.","Collecting samples, the team analyzed them remotely."], ans:0, expl:"Semicolon correctly links two independent clauses."},
    {id:"rw8", diff:1, stem:"Choose the answer that improves pronoun clarity.", choices:["When Kim texted Jess about the meeting, she said to move it.","When Kim texted Jess about the meeting, Jess said to move it.","When Kim texted Jess about the meeting, Kim said to move it.","When Kim texted Jess about the meeting, they said to move it."], ans:1, expl:"Disambiguates 'she'."},
    {id:"rw9", diff:2, stem:"Which choice most effectively introduces the paragraph about coral bleaching?", choices:["Corals are colorful.","Marine ecosystems matter to many people.","Rising ocean temperatures can disrupt the symbiosis that corals rely on, threatening reefs.","Many tourists enjoy snorkeling."], ans:2, expl:"Specific and previews the topic."},
    {id:"rw10", diff:3, stem:"In the sentence 'Researchers elicit participants' responses,' the word 'elicit' most nearly means:", choices:["forbid","draw out","list","anticipate"], ans:1, expl:"Elicit ≈ draw out."}
  ],
  math: [
    {id:"m1", diff:1, stem:"Solve: 3x + 5 = 17", choices:["x=3","x=4","x=5","x=6"], ans:1, expl:"3x=12 ⇒ x=4."},
    {id:"m2", diff:1, stem:"What is the slope of the line through (2,3) and (6,11)?", choices:["1","2","1/2","1/3"], ans:1, expl:"(11−3)/(6−2)=8/4=2."},
    {id:"m3", diff:2, stem:"A function is defined by f(x)=x²−4x. What is f(−2)?", choices:["12","-12","8","-8"], ans:0, expl:"(−2)²−4(−2)=4+8=12."},
    {id:"m4", diff:2, stem:"A rectangle has perimeter 30 and length 9. What is the width?", choices:["6","5","3","12"], ans:0, expl:"2(9+w)=30 ⇒ 9+w=15 ⇒ w=6."},
    {id:"m5", diff:3, stem:"If (x−3)(x+5)=0, what is the sum of the solutions?", choices:["2","-2","8","-8"], ans:1, expl:"Roots are 3 and −5 → sum = 3+(−5)=−2."},
    {id:"m6", diff:2, stem:"The mean of 6, 8, 10, x is 9. What is x?", choices:["10","12","14","16"], ans:1, expl:"(6+8+10+x)/4=9 ⇒ 24+x=36 ⇒ x=12."},
    {id:"m7", diff:3, stem:"System: y=2x+1 and y=−x+7. Find x.", choices:["1","2","3","4"], ans:1, expl:"2x+1=−x+7 ⇒ 3x=6 ⇒ x=2."},
    {id:"m8", diff:2, stem:"A right triangle has legs 5 and 12. What is the hypotenuse?", choices:["12","13","17","10"], ans:1, expl:"5²+12²=25+144=169 ⇒ √169=13."},
    {id:"m9", diff:3, stem:"If g(x)=2x+3 and h(x)=x−1, compute g(h(4)).", choices:["7","9","10","11"], ans:1, expl:"h(4)=4−1=3; g(3)=2(3)+3=9."},
    {id:"m10", diff:3, stem:"What is the solution to |2x−5|=7?", choices:["x=1 or x=6","x=−1 or x=6","x=−1 or x=1","x=1 only"], ans:1, expl:"2x−5=±7 ⇒ x=6 or x=−1."}
  ]
};

// dump sample bank to details
document.addEventListener('DOMContentLoaded', function() {
  const sampleDump = document.getElementById('sampleDump');
  sampleDump.textContent = JSON.stringify(bank, null, 2);
});

let state = {
  section: 'rw',
  module: 1,
  current: [],
  answers: {},
  correct: 0,
  attempted: 0,
  timed: false,
  adaptive: false,
  perModule: 10,
  timer: null,
  timeLeft: 0,
  finished: false
};

function byDifficulty(arr, target){
  // pick half easy/med (<=2) and half hard (>=2) around target size
  const easy = arr.filter(q=>q.diff<=2);
  const hard = arr.filter(q=>q.diff>=2);
  return {easy, hard};
}

function pick(arr, n){
  const copy = [...arr];
  const out=[]; 
  while(out.length<n && copy.length){
    const i = Math.floor(Math.random()*copy.length);
    out.push(copy.splice(i,1)[0]);
  } 
  return out;
}

function assemble(moduleNum, section, hard=false){
  const pool = section==='rw'? bank.rw : bank.math;
  const {easy, hard:hardP} = byDifficulty(pool, state.perModule);
  const half = Math.floor(state.perModule/2);
  let set = [];
  if(!hard){ 
    set = [...pick(easy, half), ...pick(hardP, state.perModule-half)]; 
  }
  else { 
    set = pick(hardP, state.perModule);
  }
  // shuffle
  return set.sort(()=>Math.random()-0.5);
}

function renderModule(){
  const area = document.getElementById('testArea');
  const sec = state.section === 'mixed' ? (state.module===1 ? 'rw' : 'math') : state.section;
  const hard = state.adaptive && state.module===2 && state.attempted > 0 && (state.correct/state.attempted >= 0.7);
  state.current = assemble(state.module, sec, hard);
  area.innerHTML = '';
  
  document.getElementById('mnum').textContent = state.module;
  document.getElementById('progress').textContent = `Module ${state.module} • ${sec.toUpperCase()} • ${hard? 'Harder (adaptive)':''}`;

  state.current.forEach((q, idx)=>{
    const block = document.createElement('div');
    block.className='q';
    block.innerHTML = `<h4>Q${idx+1}. ${escapeHtml(q.stem)}</h4>`;
    const opts = document.createElement('div');
    opts.className='opt';
    q.choices.forEach((c,i)=>{
      const id = `${q.id}_${i}`;
      const lab = document.createElement('label');
      lab.innerHTML = `<input type="radio" name="${q.id}" value="${i}"/> <div>${escapeHtml(c)}</div>`;
      lab.addEventListener('change',()=>record(q,i));
      opts.appendChild(lab);
    });
    block.appendChild(opts);
    area.appendChild(block);
  });
  
  // Add finish module button
  const finishBtn = document.createElement('button');
  finishBtn.textContent = state.module === 2 || state.section !== 'mixed' && state.module === 2 ? 'Finish Test' : 'Finish Module & Continue';
  finishBtn.className = 'finish-btn';
  finishBtn.onclick = nextModule;
  area.appendChild(finishBtn);

  if(state.timed){ 
    startTimer(sec==='rw'? 32*60 : 35*60); 
  }
}

function record(q, i){
  if(state.answers[q.id]===undefined){ 
    state.attempted++; 
  }
  
  // Remove previous correct count for this question if it was counted
  if(q._counted && state.answers[q.id] !== q.ans) {
    state.correct--;
    q._counted = false;
  }
  
  state.answers[q.id] = i;
  
  if(i===q.ans){
    if(!q._counted){ 
      state.correct++; 
      q._counted=true; 
    }
  } else {
    q._counted = false;
  }
  
  updateScore();
}

function updateScore() {
  document.getElementById('attempted').textContent = state.attempted;
  document.getElementById('correct').textContent = state.correct;
  document.getElementById('scaled').textContent = estimateScore();
}

function estimateScore(){
  // very rough mapping per section to 200-800 scale using percent correct
  if(state.attempted===0) return '—';
  const pct = state.correct / state.attempted;
  const scaled = Math.round(200 + pct*600);
  return scaled;
}

function startTimer(seconds){
  state.timeLeft = seconds; 
  const clock = document.getElementById('clock');
  clock.classList.remove('hidden');
  clock.textContent = fmt(seconds);
  clearInterval(state.timer);
  state.timer = setInterval(()=>{
    state.timeLeft--; 
    clock.textContent = fmt(state.timeLeft);
    if(state.timeLeft<=0){ 
      clearInterval(state.timer); 
      nextModule(); 
    }
  }, 1000);
}

function fmt(s){
  const m = String(Math.floor(s/60)).padStart(2,'0');
  const sec = String(s%60).padStart(2,'0');
  return `${m}:${sec}`;
}

function nextModule(){
  // Clear timer
  clearInterval(state.timer);
  document.getElementById('clock').classList.add('hidden');
  
  // Check if we should continue to module 2
  const shouldContinue = (state.section === 'mixed' && state.module === 1) || 
                        (state.section !== 'mixed' && state.module === 1);
  
  if(shouldContinue && !state.finished) {
    // Show review for current module first
    reviewModule();
    
    // Reset for next module but keep overall stats
    const currentCorrect = state.correct;
    const currentAttempted = state.attempted;
    
    // Move to module 2
    state.module = 2;
    state.current = [];
    
    // Keep cumulative stats
    state.correct = currentCorrect;
    state.attempted = currentAttempted;
    
    // Add continue button
    const area = document.getElementById('testArea');
    const continueBtn = document.createElement('button');
    continueBtn.textContent = 'Continue to Module 2';
    continueBtn.style.marginTop = '16px';
    continueBtn.onclick = () => renderModule();
    area.appendChild(continueBtn);
    
    return;
  }
  
  // Test is finished
  state.finished = true;
  reviewModule();
  document.getElementById('progress').textContent = 'Test Complete — see explanations above';
}

function reviewModule(){
  const area = document.getElementById('testArea');
  const review = document.createElement('div');
  review.style.marginTop='16px';
  review.innerHTML = `<h3 style="color:var(--fg)">Module ${state.module} Explanations</h3>`;
  
  state.current.forEach((q, idx)=>{
    const chosen = state.answers[q.id];
    const correct = q.ans;
    const ok = chosen===correct;
    const box = document.createElement('div');
    box.className='q';
    box.innerHTML = `<div class="tag ${ok?'good':'bad'}">Q${idx+1}: ${ok?'Correct':'Incorrect'}</div>`+
      `<div style="color:var(--muted);margin:6px 0 4px"><strong>Your answer:</strong> ${chosen !== undefined ? q.choices[chosen] : 'Not answered'}</div>`+
      `<div style="color:var(--accent);margin:4px 0 6px"><strong>Correct answer:</strong> ${q.choices[correct]}</div>`+
      `<div style="color:var(--fg);margin:6px 0">${escapeHtml(q.expl)}</div>`;
    review.appendChild(box);
  });
  area.appendChild(review);
}

function resetAll(){
  clearInterval(state.timer);
  state = {
    section:'rw', 
    module:1, 
    current:[], 
    answers:{}, 
    correct:0, 
    attempted:0, 
    timed:false, 
    adaptive:false, 
    perModule:10, 
    timer:null, 
    timeLeft:0,
    finished:false
  };
  document.getElementById('testArea').innerHTML='';
  document.getElementById('correct').textContent='0';
  document.getElementById('attempted').textContent='0';
  document.getElementById('scaled').textContent='—';
  document.getElementById('progress').textContent='Ready';
  document.getElementById('mnum').textContent='–';
  document.getElementById('clock').classList.add('hidden');
}

function exportJSON(){
  const data = {rw: bank.rw, math: bank.math};
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); 
  a.href=url; 
  a.download='sat_item_bank.json'; 
  a.click(); 
  URL.revokeObjectURL(url);
}

function importJSON(){
  const inp = document.createElement('input'); 
  inp.type='file'; 
  inp.accept='application/json';
  inp.onchange = (e)=>{
    const file = e.target.files[0]; 
    if(!file) return;
    const r = new FileReader(); 
    r.onload=()=>{
      try{ 
        const obj = JSON.parse(r.result);
        if(obj.rw && obj.math){ 
          bank.rw = obj.rw; 
          bank.math = obj.math; 
          document.getElementById('sampleDump').textContent = JSON.stringify(bank,null,2); 
          alert('Imported item bank ✓'); 
        }
        else {
          alert('Invalid format: expected { rw:[], math:[] }');
        }
      }catch(err){ 
        alert('Invalid JSON'); 
      }
    }; 
    r.readAsText(file);
  };
  inp.click();
}

function escapeHtml(str){ 
  return String(str).replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); 
}

// UI wiring - Fixed to use proper element references
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('startBtn').onclick = ()=>{
    state.section = document.getElementById('section').value;
    state.perModule = Math.max(2, Math.min(40, parseInt(document.getElementById('count').value||10)));
    state.adaptive = document.getElementById('adaptive').checked;
    state.timed = document.getElementById('timed').checked;
    state.module = 1; 
    state.answers={}; 
    state.correct=0; 
    state.attempted=0;
    state.finished=false;
    renderModule();
  };
  
  document.getElementById('resetBtn').onclick = resetAll;
  document.getElementById('exportBtn').onclick = exportJSON;
  document.getElementById('importBtn').onclick = importJSON;
});
</script>
</body>
</html>